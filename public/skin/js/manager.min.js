function NavToggle() {
    $(".navbar-minimalize").trigger("click")
}
function SmoothlyMenu() {
    $("body").hasClass("mini-navbar") ? $("body").hasClass("fixed-sidebar") ? ($("#side-menu").hide(), setTimeout(function() {
            $("#side-menu").fadeIn(500)
        },
        300)) : $("#side-menu").removeAttr("style") : ($("#side-menu").hide(), setTimeout(function() {
            $("#side-menu").fadeIn(500)
        },
        100))
}

/*
* localstorage支持
* */
function localStorageSupport() {
    return "localStorage" in window && null !== window.localStorage
}

/*
* 加载层
* */
function loading(close)
{
    Boolean(close) ? $('#loadding_box').fadeOut(800) : $('#loadding_box').fadeIn(800);
}

/*
* 图片上传
* */
function Sthumb(i,w,h,c){
    $.post(AJPath,{ac:'thumb',i:i,w:w,h:h,c:c},function(data){
        layer.open({
            area:'800px',
            title:'上传图片',
            type:1,
            content:data
        })
    });

}

/*
 * 上传图片回调
 * */
function callback(url,i){
    $('#'+i).val(url);
    try{
        $('#p'+i).attr('src',url);
    }catch(e){}
}

/*
* 图片选择
* */
function Schoose_thumb(i,w,h){
    $.post(AJPath,{ac:'choose_thumb',i:i,w:w,h:h},function(data){
        layer.open({
            area:['800px','500px'],
            title:'相册选择',
            type:1,
            content:data
        })
    });
}

/*
* 图片预览
* */
function preview(src,w,h,t){
    var t = t ? false : '图片预览';
    if( src ){
        var w = w+0;
        var h = h+42;
        layer.open({
            area:[w+'px',h+'px'],
            type:1,
            title:t,
            shadeClose:true,
            content:"<img src='"+src+"'/>"
        });
    }
}
// layer.config({
//     extend: ["extend/layer.ext.js", "skin/moon/style.css"],
//     skin: "layer-ext-moon"
// }),
    $(document).ready(function() {
        function e() {
            var e = $("body > #wrapper").height() - 61;
            $(".sidebard-panel").css("min-height", e + "px")
        }
        $("#side-menu").metisMenu(),
            $(".right-sidebar-toggle").click(function() {
                $("#right-sidebar").toggleClass("sidebar-open")
            }),

            $(".open-small-chat").click(function() {
                $(this).children().toggleClass("fa-comments").toggleClass("fa-remove"),
                    $(".small-chat-box").toggleClass("active")
            }),

            $(".check-link").click(function() {
                var e = $(this).find("i"),
                    a = $(this).next("span");
                return e.toggleClass("fa-check-square").toggleClass("fa-square-o"),
                    a.toggleClass("todo-completed"),
                    !1
            }),

            $(".navbar-minimalize").click(function() {
                $("body").toggleClass("mini-navbar"),
                    SmoothlyMenu()
            }),
            e(),
            $(window).bind("load resize click scroll",
                function() {
                    $("body").hasClass("body-small") || e()
                }),
            $(window).scroll(function() {
                $(window).scrollTop() > 0 && !$("body").hasClass("fixed-nav") ? $("#right-sidebar").addClass("sidebar-top") : $("#right-sidebar").removeClass("sidebar-top")
            }),

            $("#side-menu>li").click(function() {
                $("body").hasClass("mini-navbar") && NavToggle()
            }),
            $("#side-menu>li li a").click(function() {
                $(window).width() < 769 && NavToggle()
            }),
            $(".nav-close").click(NavToggle),
        /(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent) && $("#content-main").css("overflow-y", "auto")
    }),
    $(window).bind("load resize",
        function() {
            $(this).width() < 769 && ($("body").addClass("mini-navbar"), $(".navbar-static-side").fadeIn())
        }),
    $(function() {
        if ($("#fixednavbar").click(function() {
                $("#fixednavbar").is(":checked") ? ($(".navbar-static-top").removeClass("navbar-static-top").addClass("navbar-fixed-top"), $("body").removeClass("boxed-layout"), $("body").addClass("fixed-nav"), $("#boxedlayout").prop("checked", !1), localStorageSupport && localStorage.setItem("boxedlayout", "off"), localStorageSupport && localStorage.setItem("fixednavbar", "on")) : ($(".navbar-fixed-top").removeClass("navbar-fixed-top").addClass("navbar-static-top"), $("body").removeClass("fixed-nav"), localStorageSupport && localStorage.setItem("fixednavbar", "off"))
            }), $("#collapsemenu").click(function() {
                $("#collapsemenu").is(":checked") ? ($("body").addClass("mini-navbar"), SmoothlyMenu(), localStorageSupport && localStorage.setItem("collapse_menu", "on")) : ($("body").removeClass("mini-navbar"), SmoothlyMenu(), localStorageSupport && localStorage.setItem("collapse_menu", "off"))
            }), $("#boxedlayout").click(function() {
                $("#boxedlayout").is(":checked") ? ($("body").addClass("boxed-layout"), $("#fixednavbar").prop("checked", !1), $(".navbar-fixed-top").removeClass("navbar-fixed-top").addClass("navbar-static-top"), $("body").removeClass("fixed-nav"), localStorageSupport && localStorage.setItem("fixednavbar", "off"), localStorageSupport && localStorage.setItem("boxedlayout", "on")) : ($("body").removeClass("boxed-layout"), localStorageSupport && localStorage.setItem("boxedlayout", "off"))
            }), $(".s-skin-0").click(function() {
                return $("body").removeClass("skin-1"),
                    $("body").removeClass("skin-2"),
                    $("body").removeClass("skin-3"),
                    !1
            }), $(".s-skin-1").click(function() {
                return $("body").removeClass("skin-2"),
                    $("body").removeClass("skin-3"),
                    $("body").addClass("skin-1"),
                    !1
            }), $(".s-skin-3").click(function() {
                return $("body").removeClass("skin-1"),
                    $("body").removeClass("skin-2"),
                    $("body").addClass("skin-3"),
                    !1
            }), localStorageSupport) {
            var e = localStorage.getItem("collapse_menu"),
                a = localStorage.getItem("fixednavbar"),
                o = localStorage.getItem("boxedlayout");
            "on" == e && $("#collapsemenu").prop("checked", "checked"),
            "on" == a && $("#fixednavbar").prop("checked", "checked"),
            "on" == o && $("#boxedlayout").prop("checked", "checked")
        }
        if (localStorageSupport) {
            var e = localStorage.getItem("collapse_menu"),
                a = localStorage.getItem("fixednavbar"),
                o = localStorage.getItem("boxedlayout"),
                l = $("body");
            "on" == e && (l.hasClass("body-small") || l.addClass("mini-navbar")),
            "on" == a && ($(".navbar-static-top").removeClass("navbar-static-top").addClass("navbar-fixed-top"), l.addClass("fixed-nav")),
            "on" == o && l.addClass("boxed-layout")
        }

        // i-check 样式
        $('.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
        });
        $('#side-menu li ul a.current').parent().parent().parent().addClass('active');
        $('#side-menu li ul a.current').parent().parent().addClass('in');
        $("[data-toggle='tooltip']").tooltip();

        //后台菜单点击时开始loading动画
        //一级菜单
        $('#side-menu li>a').click(function(){
            if($(this).next('ul').length == 0){
                loading();
            }
        });
        //二级菜单点击时开始loading动画
        $('#side-menu li ul a').click(function(){
            loading();
        });
        //模态框中的表单提交时开始loading动画
        $('.modal form [type=submit]').click(function(){
            loading();
        });

        loading(true);
        if($('#MessageBox').length){
            setTimeout(function(){
                $('#MessageBox').hide(1000);
            },10000);
        }
        //$('body').addClass('mini-navbar');
    });